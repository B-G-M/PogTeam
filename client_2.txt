using System;
using System.IO;
using System.Net.Sockets;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

namespace Client_API
{
    class Client
    {
        
        public static async Task Main(string[] args)
        {
            using var client=new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
            
            try
            {
                String host = "10.162.250.246";
                int port = 8080;
                
                await client.ConnectAsync(host, port);
                Console.WriteLine("Success");
              
                Send(client);
                Console.WriteLine("Сообщение отправлено");
                
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.StackTrace);
            }

        }

        private static String SendAuthorisation(String login, String password)
        {

            return $"{login}_{password}";
        }
        
        public static void Send(Socket sender)
        {
            byte[] msg = Encoding.UTF8.GetBytes(
                SendAuthorisation("gg","wp"));
            int bytesSent = sender.Send(msg);
            Console.WriteLine("send the login");
            
            while (true)
            {
                String massage = Console.ReadLine();
                msg=Encoding.UTF8.GetBytes(massage);
                bytesSent = sender.Send(msg);
                Console.WriteLine("send the massage");
            }
        }
        
        
        
    }

}